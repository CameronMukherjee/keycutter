package com.hexploits.kc.service.event.internal;

import io.micronaut.context.event.ApplicationEventPublisher;
import jakarta.inject.Singleton;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import reactor.util.annotation.NonNull;

@Singleton
public class KcCommandPublisher implements ApplicationEventPublisher<KcCommandEvent> {

  private final Logger log = LoggerFactory.getLogger(KcCommandPublisher.class);
  private final ApplicationEventPublisher<KcCommandEvent> eventPublisher;

  public KcCommandPublisher(ApplicationEventPublisher<KcCommandEvent> eventPublisher) {
    this.eventPublisher = eventPublisher;
  }

  @Override
  public void publishEvent(@NonNull KcCommandEvent event) {
    if (event.getKcUser().isPresent()) {
      log.info("Event internally published: \nTOPIC: {} \nKEY: {} \nDATA: {}\n-----",
        event.getEventType().getTopic(),
        event.getKcUser().get().getUid(),
        event
      );
    } else {
      log.info("Event internally published: \nTOPIC: {} \nKEY: N/A\nDATA: {}\n-----",
        event.getEventType().getTopic(),
        event
      );
    }

    eventPublisher.publishEvent(event);
  }
}
