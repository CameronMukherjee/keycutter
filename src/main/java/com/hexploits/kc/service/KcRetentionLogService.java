package com.hexploits.kc.service;

import com.hexploits.kc.model.KcRetentionProcessingLog;
import com.hexploits.kc.repository.KcRetentionProcessingRepository;
import io.micronaut.data.model.Page;
import io.micronaut.data.model.Pageable;
import io.micronaut.data.model.Sort;
import io.micronaut.data.model.Sort.Order;
import io.micronaut.transaction.annotation.ReadOnly;
import jakarta.inject.Singleton;

@Singleton
public class KcRetentionLogService {

  private final KcRetentionProcessingRepository kcRetentionProcessingRepository;

  public KcRetentionLogService(KcRetentionProcessingRepository kcRetentionProcessingRepository) {
    this.kcRetentionProcessingRepository = kcRetentionProcessingRepository;
  }

  @ReadOnly
  public Page<KcRetentionProcessingLog> fetchRetentionLogs(Pageable pageable) {
    return kcRetentionProcessingRepository
      .findAll(Pageable.from(pageable.getNumber(), pageable.getSize(), Sort.of(Order.desc("createdAt"))));
  }
}
