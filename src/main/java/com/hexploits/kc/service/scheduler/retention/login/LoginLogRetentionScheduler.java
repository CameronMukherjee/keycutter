package com.hexploits.kc.service.scheduler.retention.login;

import io.micronaut.context.annotation.Requires;
import io.micronaut.context.annotation.Value;
import io.micronaut.scheduling.annotation.Scheduled;
import jakarta.inject.Singleton;
import java.util.Optional;

@Singleton
@Requires(property = "kc.logs.login.strategy", notEquals = "none")
public class LoginLogRetentionScheduler {

  private final Integer daysOfRetention;
  private final ILoginLogRetentionStrategy logRetentionStrategy;

  public LoginLogRetentionScheduler(
    @Value("${kc.logs.login.period}") Integer daysOfRetention,
    ILoginLogRetentionStrategy schedulerStrategy) {
    this.daysOfRetention = daysOfRetention;
    this.logRetentionStrategy = schedulerStrategy;
  }

  /**
   * Run once a week on midnight on sunday.
   */
  @Scheduled(cron = "0 0 * * SUN")
  public void processLogs() {
    logRetentionStrategy.process(Optional.of(daysOfRetention));
  }
}
