package com.hexploits.kc.service.scheduler.retention.event;

import io.micronaut.context.annotation.Value;
import io.micronaut.scheduling.annotation.Scheduled;
import jakarta.inject.Singleton;
import java.util.Optional;

@Singleton
public class EventLogRetentionScheduler {

  private final Integer daysOfRetention;
  private final IEventLogRetentionStrategy logRetentionStrategy;

  public EventLogRetentionScheduler(
    @Value("${kc.logs.events.period}") Integer daysOfRetention,
    IEventLogRetentionStrategy schedulerStrategy) {
    this.daysOfRetention = daysOfRetention;
    this.logRetentionStrategy = schedulerStrategy;
  }

  /**
   * Run once a week on midnight on sunday.
   */
  @Scheduled(cron = "0 0 * * SUN")
  public void processLogs() {
    logRetentionStrategy.process(Optional.ofNullable(daysOfRetention));
  }
}
