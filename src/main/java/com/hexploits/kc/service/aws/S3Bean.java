package com.hexploits.kc.service.aws;

import io.micronaut.context.annotation.Bean;
import io.micronaut.context.annotation.Value;
import jakarta.inject.Singleton;
import software.amazon.awssdk.auth.credentials.AwsBasicCredentials;
import software.amazon.awssdk.auth.credentials.StaticCredentialsProvider;
import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.s3.S3Client;

@Singleton
public class S3Bean {

  private final String region;
  private final String accessKeyId;
  private final String secretAccessKey;

  public S3Bean(
    @Value("${aws.region}") String region,
    @Value("${aws.accessKeyId}") String accessKeyId,
    @Value("${aws.secretKey}") String secretAccessKey) {
    this.region = region;
    this.accessKeyId = accessKeyId;
    this.secretAccessKey = secretAccessKey;
  }

  @Bean
  public S3Client getS3Client() {
    AwsBasicCredentials credentials = AwsBasicCredentials.create(accessKeyId, secretAccessKey);
    return S3Client
      .builder()
      .region(Region.of(region))
      .credentialsProvider(StaticCredentialsProvider.create(credentials))
      .build();
  }
}
